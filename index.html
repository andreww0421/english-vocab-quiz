<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬äº”å†ŠU6å–®å­—æ¸¬é©—</title>
    <style>
        :root {
            --primary: #4a90e2;
            --success: #2ecc71;
            --fail: #e74c3c;
            --warning: #f1c40f;
            --bg: #f5f7fa;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .container {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 600px;
            text-align: center;
            position: relative;
            overflow: hidden; /* For timer bar */
        }

        h1 { color: #333; margin-bottom: 1rem; }
        
        /* æŒ‰éˆ•æ¨£å¼ */
        .btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 8px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: transform 0.1s, background 0.2s;
            display: inline-block;
        }
        .btn:hover { background-color: #357abd; transform: translateY(-2px); }
        .btn:active { transform: translateY(0); }
        .btn:disabled { background-color: #ccc; cursor: not-allowed; }

        .btn-purple { background-color: #9b59b6; }
        .btn-purple:hover { background-color: #8e44ad; }

        .btn-option {
            display: block;
            width: 100%;
            margin: 10px 0;
            text-align: left;
            background-color: #fff;
            color: #333;
            border: 2px solid #e0e0e0;
        }
        .btn-option:hover { background-color: #f0f8ff; border-color: var(--primary); }

        /* é¡Œç›®å€åŸŸ */
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 0.9rem;
            color: #666;
        }

        .question-box {
            font-size: 1.8rem;
            font-weight: bold;
            margin: 10px 0 25px 0;
            color: #2c3e50;
            padding: 20px;
            background: #ecf0f1;
            border-radius: 10px;
            position: relative;
        }

        .phonetic {
            display: block;
            font-size: 1rem;
            color: #7f8c8d;
            margin-top: 5px;
            font-weight: normal;
        }

        /* èªéŸ³æŒ‰éˆ• */
        .audio-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--primary);
            font-size: 1.5rem;
            margin-left: 10px;
            vertical-align: middle;
        }
        .audio-btn:hover { color: #357abd; transform: scale(1.1); }

        /* è¨ˆæ™‚æ¢ */
        .timer-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background-color: #eee;
        }
        .timer-bar {
            height: 100%;
            background-color: var(--fail);
            width: 100%;
            transition: width linear;
        }

        /* æ‹¼å­—è¼¸å…¥æ¡† */
        .input-group {
            margin: 20px 0;
        }
        .spelling-input {
            width: 70%;
            padding: 12px;
            font-size: 1.2rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            outline: none;
        }
        .spelling-input:focus { border-color: var(--primary); }

        /* çµæœèˆ‡ç‹€æ…‹ */
        .hidden { display: none; }
        .result-pass { color: var(--success); font-weight: bold; font-size: 1.5rem; }
        .result-fail { color: var(--fail); font-weight: bold; font-size: 1.5rem; }
        
        .result-details {
            margin-top: 20px;
            text-align: left;
            max-height: 300px;
            overflow-y: auto;
            border-top: 1px solid #eee;
        }
        .review-item { padding: 10px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .review-item.wrong { color: var(--fail); }
        .review-audio { cursor: pointer; color: var(--primary); font-size: 1.2rem; }
    </style>
</head>
<body>

<div class="container" id="app">
    <div class="timer-container hidden" id="timer-container">
        <div class="timer-bar" id="timer-bar"></div>
    </div>

    <div id="start-screen">
        <h1>ç¬¬äº”å†ŠU6å–®å­—æ¸¬é©—</h1>
        <p>è³‡æ–™åº«å…± 42 å€‹å–®å­—<br>é€šéæ¨™æº–ï¼šç­”å°ç‡ 60%</p>
        <button class="btn" onclick="startQuiz('mixed')">ğŸ”Š é–‹å§‹æ¸¬é©—</button>
        <br>
        <button class="btn btn-purple" onclick="startQuiz('spelling')">âŒ¨ï¸ æ‹¼å­—æŒ‘æˆ° (é«˜é›£åº¦)</button>
    </div>

    <div id="quiz-screen" class="hidden">
        <div class="question-header">
            <span>é¡Œæ•¸: <span id="current-q">1</span> / <span id="total-q">10</span></span>
            <span id="timer-text" style="color:var(--fail); font-weight:bold;">10s</span>
        </div>
        
        <div class="question-box" id="question-text">
            </div>

        <div id="options-container"></div>

        <div id="spelling-container" class="input-group hidden">
            <input type="text" id="spelling-input" class="spelling-input" placeholder="è¼¸å…¥è‹±æ–‡å–®å­—..." autocomplete="off">
            <button class="btn" onclick="submitSpelling()">é€å‡º</button>
        </div>
    </div>

    <div id="result-screen" class="hidden">
        <h1>æ¸¬é©—çµæœ</h1>
        <p id="score-text"></p>
        <div id="pass-fail-msg"></div>
        <button class="btn" onclick="location.reload()">é‡æ–°æ¸¬é©—</button>
        
        <div class="result-details" id="review-list">
            </div>
    </div>
</div>

<script>
    // å–®å­—è³‡æ–™åº«
    const vocabData = [
        { id: 1, en: "apartment", ph: "[É™`partmÉ™nt]", zh: "å…¬å¯“" },
        { id: 2, en: "glad", ph: "[glÃ¦d]", zh: "é«˜èˆˆçš„" },
        { id: 3, en: "town", ph: "[taÊŠn]", zh: "åŸé®" },
        { id: 4, en: "polite", ph: "[pÉ™`laÉªt]", zh: "æœ‰ç¦®è²Œçš„" },
        { id: 5, en: "seat", ph: "[sit]", zh: "åº§ä½" },
        { id: 6, en: "beside", ph: "[bÉª`saÉªd]", zh: "åœ¨...æ—é‚Š" },
        { id: 7, en: "except", ph: "[Éªk`sÉ›pt]", zh: "é™¤äº†" },
        { id: 8, en: "blank", ph: "[blÃ¦Å‹k]", zh: "ç©ºç™½(çš„)" },
        { id: 9, en: "present", ph: "[`prÉ›zá¹‡t]", zh: "ç¦®ç‰©" },
        { id: 10, en: "invite", ph: "[Éªn`vaÉªt]", zh: "é‚€è«‹" },
        { id: 11, en: "perhaps", ph: "[pÉ™`hÃ¦ps]", zh: "æˆ–è¨±" },
        { id: 12, en: "kiss", ph: "[kÉªs]", zh: "å»" },
        { id: 13, en: "side", ph: "[saÉªd]", zh: "å´é¢ï¼›é‚Š" },
        { id: 14, en: "sidewalk", ph: "[`saÉªd,wÉ”k]", zh: "äººè¡Œé“" },
        { id: 15, en: "blind", ph: "[blaÉªnd]", zh: "ç›²çš„" },
        { id: 16, en: "April Fools' Day", ph: "[`eprÉ™l `fulz ,de]", zh: "æ„šäººç¯€" },
        { id: 17, en: "tape", ph: "[tep]", zh: "ç”¨è† å¸¶é»è²¼ï¼›è† å¸¶" },
        { id: 18, en: "paper", ph: "[`pepÉš]", zh: "ç´™" },
        { id: 19, en: "joke", ph: "[dÊ’ok]", zh: "ç©ç¬‘ï¼›ç¬‘è©±" },
        { id: 20, en: "visitor", ph: "[`vÉªzÉªtÉš]", zh: "éŠå®¢ï¼›åƒè§€è€…" },
        { id: 21, en: "somewhere", ph: "[`sÊŒm,(h)wÉ›r]", zh: "åœ¨æŸè™•" },
        { id: 22, en: "mud", ph: "[mÊŒd]", zh: "æ³¥åœŸ" },
        { id: 23, en: "ahead", ph: "[É™`hÉ›d]", zh: "åœ¨å‰æ–¹" },
        { id: 24, en: "heat", ph: "[hit]", zh: "é«˜æº«ï¼›åŠ ç†±" },
        { id: 25, en: "rise", ph: "[raÉªz]", zh: "å‡èµ·ï¼›èµ·èº«" },
        { id: 26, en: "rich", ph: "[rÉªtÊƒ]", zh: "å¯Œæœ‰çš„" },
        { id: 27, en: "lazy", ph: "[`lezÉª]", zh: "æ‡¶æƒ°çš„ï¼›æ…µæ‡¶çš„" },
        { id: 28, en: "have bigger fish to fry", ph: "[hÃ¦v `bÉªgÉš ,fÉªÊƒ tÉ™ `fraÉª]", zh: "æœ‰æ›´é‡è¦çš„äº‹è¦åš" },
        { id: 29, en: "smoke", ph: "[smok]", zh: "ç…™éœ§ï¼›æŠ½è¸" },
        { id: 30, en: "cover", ph: "[`kÊŒvÉš]", zh: "è¦†è“‹ï¼›é®è“‹(ç‰©)" },
        { id: 31, en: "used to", ph: "[`just tÉ™]", zh: "éå»æ™‚å¸¸..." },
        { id: 32, en: "appear", ph: "[É™`pÉªr]", zh: "ä¼¼ä¹" },
        { id: 33, en: "serious", ph: "[`sÉªrÉªÉ™s]", zh: "èªçœŸçš„" },
        { id: 34, en: "lie", ph: "[laÉª]", zh: "èººï¼›è‡¥ (ç¾åœ¨åˆ†è©ç‚º lying)" },
        { id: 35, en: "draw", ph: "[drÉ”]", zh: "æå– (æ°´ã€éŒ¢)" },
        { id: 36, en: "spell", ph: "[spÉ›l]", zh: "å’’èª" },
        { id: 37, en: "worthless", ph: "[`wÉœÎ¸lÉªs]", zh: "ç„¡åƒ¹å€¼çš„" },
        { id: 38, en: "chat", ph: "[tÊƒÃ¦t]", zh: "èŠå¤©" },
        { id: 39, en: "resist", ph: "[rÉª`zÉªst]", zh: "æŠµæŠ—" },
        { id: 40, en: "complain", ph: "[kÉ™m`plen]", zh: "æŠ±æ€¨" },
        { id: 41, en: "fairy", ph: "[`fÉ›rÉª]", zh: "ç²¾éˆï¼›ä»™å­" },
        { id: 42, en: "jewel", ph: "[`dÊ’uÉ™l]", zh: "å¯¶çŸ³" }
    ];

    let currentMode = ''; 
    let questionList = [];
    let currentIndex = 0;
    let score = 0;
    let userAnswers = [];
    // æ–°å¢ä¸€å€‹è®Šæ•¸ä¾†è¨˜éŒ„ç•¶å‰é¡Œç›®çš„æ¨¡å¼ ('en-zh' æˆ– 'zh-en')
    let currentQuestionMode = ''; 
    
    // è¨ˆæ™‚å™¨è®Šæ•¸
    let timerInterval;
    let timeLimit = 10; // ç§’
    let timeRemaining = 10;

    // èªéŸ³æœ—è®€åŠŸèƒ½
    function speakText(text) {
        if ('speechSynthesis' in window) {
            window.speechSynthesis.cancel(); // åœæ­¢ä¸Šä¸€å€‹ç™¼éŸ³
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US'; // è¨­å®šç‚ºç¾å¼ç™¼éŸ³
            utterance.rate = 0.9; // ç¨å¾®æ…¢ä¸€é»é»
            window.speechSynthesis.speak(utterance);
        }
    }

    function startQuiz(mode) {
        currentMode = mode;
        score = 0;
        currentIndex = 0;
        userAnswers = [];
        
        // è¨­å®šä¸åŒæ¨¡å¼çš„æ™‚é–“é™åˆ¶
        timeLimit = (mode === 'spelling') ? 15 : 10;

        questionList = [...vocabData].sort(() => 0.5 - Math.random());
        
        document.getElementById('start-screen').classList.add('hidden');
        document.getElementById('quiz-screen').classList.remove('hidden');
        document.getElementById('timer-container').classList.remove('hidden');
        
        renderQuestion();
    }

    function renderQuestion() {
        const currentQ = questionList[currentIndex];
        const qTextEl = document.getElementById('question-text');
        const optionsEl = document.getElementById('options-container');
        const spellingEl = document.getElementById('spelling-container');
        const countEl = document.getElementById('current-q');
        const totalEl = document.getElementById('total-q');

        countEl.textContent = currentIndex + 1;
        totalEl.textContent = questionList.length;

        // é‡ç½®è¨ˆæ™‚å™¨
        startTimer();

        // ä»‹é¢åˆ‡æ›
        if (currentMode === 'spelling') {
            optionsEl.classList.add('hidden');
            spellingEl.classList.remove('hidden');
            qTextEl.textContent = currentQ.zh;
            
            // æ¸…ç©ºä¸¦èšç„¦è¼¸å…¥æ¡†
            const input = document.getElementById('spelling-input');
            input.value = '';
            input.focus();
            
            // ç¶å®š Enter éµ
            input.onkeydown = (e) => { if(e.key === 'Enter') submitSpelling(); };

        } else {
            // æ··åˆæ¨¡å¼ä¸‹ï¼Œéš¨æ©Ÿæ±ºå®šé€™ä¸€é¡Œæ˜¯ã€Œè‹±ç¿»ä¸­ã€é‚„æ˜¯ã€Œä¸­ç¿»è‹±ã€
            // å¦‚æœ currentMode æ˜¯ mixedï¼Œå‰‡éš¨æ©Ÿï¼›å¦å‰‡ä¾æ“š mode æ±ºå®šï¼ˆé›–ç„¶ç›®å‰åªæœ‰ mixed æœƒé€²ä¾†ï¼‰
            currentQuestionMode = Math.random() < 0.5 ? 'en-zh' : 'zh-en';
            
            spellingEl.classList.add('hidden');
            optionsEl.classList.remove('hidden');
            
            // é¡Œç›®é¡¯ç¤º
            if (currentQuestionMode === 'en-zh') {
                qTextEl.innerHTML = `
                    ${currentQ.en} 
                    <button class="audio-btn" onclick="speakText('${currentQ.en.replace(/'/g, "\\'")}')">ğŸ”Š</button>
                    <br><span class="phonetic">${currentQ.ph}</span>
                `;
                // è‡ªå‹•æœ—è®€
                speakText(currentQ.en);
            } else {
                qTextEl.textContent = currentQ.zh;
            }

            // é¸é …ç”Ÿæˆ
            let options = [currentQ];
            while (options.length < 4) {
                const randomItem = vocabData[Math.floor(Math.random() * vocabData.length)];
                if (!options.includes(randomItem)) {
                    options.push(randomItem);
                }
            }
            options.sort(() => 0.5 - Math.random());

            optionsEl.innerHTML = '';
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'btn btn-option';
                // æ ¹æ“šç•¶å‰é¡Œç›®çš„æ¨¡å¼æ±ºå®šé¸é …å…§å®¹
                btn.textContent = (currentQuestionMode === 'en-zh') ? opt.zh : opt.en;
                btn.onclick = () => checkAnswer(opt.id, currentQ.id);
                optionsEl.appendChild(btn);
            });
        }
    }

    function startTimer() {
        clearInterval(timerInterval);
        timeRemaining = timeLimit;
        updateTimerVisuals();

        timerInterval = setInterval(() => {
            timeRemaining -= 0.1;
            updateTimerVisuals();
            
            if (timeRemaining <= 0) {
                clearInterval(timerInterval);
                handleTimeOut();
            }
        }, 100);
    }

    function updateTimerVisuals() {
        const percentage = (timeRemaining / timeLimit) * 100;
        document.getElementById('timer-bar').style.width = percentage + '%';
        document.getElementById('timer-text').textContent = Math.ceil(timeRemaining) + 's';
    }

    function handleTimeOut() {
        // æ™‚é–“åˆ°ç®—éŒ¯
        recordAnswer(false);
        nextQuestion();
    }

    function checkAnswer(selectedId, correctId) {
        clearInterval(timerInterval);
        const isCorrect = selectedId === correctId;
        
        // å¦‚æœæ˜¯ä¸­ç¿»è‹±ï¼Œç­”å°å¾Œæœ—è®€è‹±æ–‡å¢å¼·è¨˜æ†¶
        // ä½¿ç”¨ currentQuestionMode ä¾†åˆ¤æ–·
        if (isCorrect && currentQuestionMode === 'zh-en') {
            speakText(questionList[currentIndex].en);
        }

        recordAnswer(isCorrect);
        nextQuestion();
    }

    function submitSpelling() {
        clearInterval(timerInterval);
        const inputVal = document.getElementById('spelling-input').value.trim();
        const correctVal = questionList[currentIndex].en;
        
        // æ¯”å°æ™‚å¿½ç•¥å¤§å°å¯«
        const isCorrect = inputVal.toLowerCase() === correctVal.toLowerCase();

        // ç­”å°æœ—è®€
        if (isCorrect) speakText(correctVal);

        recordAnswer(isCorrect);
        nextQuestion();
    }

    function recordAnswer(isCorrect) {
        if (isCorrect) score++;
        userAnswers.push({
            question: questionList[currentIndex],
            isCorrect: isCorrect
        });
    }

    function nextQuestion() {
        currentIndex++;
        if (currentIndex < questionList.length) {
            renderQuestion();
        } else {
            finishQuiz();
        }
    }

    function finishQuiz() {
        document.getElementById('quiz-screen').classList.add('hidden');
        document.getElementById('timer-container').classList.add('hidden');
        document.getElementById('result-screen').classList.remove('hidden');

        const percentage = Math.round((score / questionList.length) * 100);
        document.getElementById('score-text').textContent = `å¾—åˆ†ï¼š${percentage}% (${score} / ${questionList.length})`;

        const msgDiv = document.getElementById('pass-fail-msg');
        if (percentage >= 60) {
            msgDiv.innerHTML = '<span class="result-pass">æ­å–œé€šéï¼ (Pass)</span>';
        } else {
            msgDiv.innerHTML = '<span class="result-fail">å†æ¥å†å²ï¼ (Fail)</span>';
        }

        const reviewList = document.getElementById('review-list');
        reviewList.innerHTML = '<h3>ç­”éŒ¯é¡Œç›®æª¢è¨ (é»æ“Šå–‡å­ç™¼éŸ³)ï¼š</h3>';
        
        const wrongAnswers = userAnswers.filter(a => !a.isCorrect);
        if (wrongAnswers.length === 0) {
            reviewList.innerHTML += '<p style="color:green">å®Œç¾ï¼å…¨å°ï¼</p>';
        } else {
            wrongAnswers.forEach(item => {
                const div = document.createElement('div');
                div.className = 'review-item wrong';
                div.innerHTML = `
                    <div>
                        <strong>${item.question.en}</strong> 
                        <br> ${item.question.zh}
                    </div>
                    <div class="review-audio" onclick="speakText('${item.question.en.replace(/'/g, "\\'")}')">ğŸ”Š</div>
                `;
                reviewList.appendChild(div);
            });
        }
    }
</script>

</body>
</html>
