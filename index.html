<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>國中英語單字測驗</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>
<body>

<div class="container" id="app">
    <div class="top-bar">
        <div class="setting-group">
            <label for="speed-select">🔊 語速:</label>
            <select id="speed-select" onchange="setSpeechSpeed(this.value)">
                <option value="0.9">0.9x</option>
                <option value="1.0" selected>1.0x (預設)</option>
                <option value="1.25">1.25x (快)</option>
                <option value="1.5">1.5x (特快)</option>
            </select>
        </div>
        <button class="icon-btn" onclick="toggleSound()" id="btn-sound" title="切換音效">🔊</button>
        </div>

    <div class="progress-container">
        <div class="progress-bar" id="total-progress"></div>
    </div>
    <div class="timer-container hidden" id="timer-container">
        <div class="timer-bar" id="timer-bar"></div>
    </div>
    
    <div class="combo-box" id="combo-box">
        <span class="combo-label">COMBO</span>
        <span class="combo-count" id="combo-count">0</span>
    </div>
    <div class="feedback-overlay" id="feedback-icon"></div>

    <div id="start-screen">
        <h1>國中英語單字測驗</h1>
        <p>每回隨機測驗 20 題<br>通過標準：80% (✔) / 100% (👑)</p>

        <div class="range-selector">
            <h3>請選擇單字範圍 (可多選)：</h3>
            <div class="range-options" id="range-container">
                <p id="loading-text" style="color:#666;">正在讀取單字庫...</p>
            </div>
            <button class="btn-small" onclick="toggleAllUnits()">全選 / 清除</button>
            <p id="range-warning" style="color:red; font-size:0.9rem; display:none;">請至少選擇一個單元！</p>
            <p id="update-status" style="color: green; font-size: 0.8rem; margin-top: 5px; height: 1.2em;"></p>
        </div>

        <div class="action-buttons">
            <button class="btn" onclick="startQuiz('mixed')">🔊 選擇題測驗</button>
            <button class="btn btn-purple" onclick="startQuiz('spelling')">⌨️ 拼字挑戰</button>
            <button class="btn btn-green" onclick="startFlashcardMode()">📖 單字卡複習</button>
        </div>

        <div style="margin-top: 15px; display: flex; justify-content: center; gap: 10px;">
            <button class="btn-small" style="background-color: #34495e;" onclick="showStats()">📊 學習統計</button>
            <button class="btn btn-red hidden" id="btn-mistake" onclick="startQuiz('mistake')">
                🔥 錯題特訓 (<span id="mistake-count">0</span>)
            </button>
        </div>
        
        <p style="margin-top:15px; font-size:0.8rem; color:#888;">
            💡 電腦版支援鍵盤操作：1-4 作答、Enter 下一題、Space 翻卡
        </p>
    </div>

    <div id="quiz-screen" class="hidden">
        <button class="back-btn" onclick="goBackToHome()">⬅ 回首頁</button>

        <div class="question-header">
            <span>題數: <span id="current-q">1</span> / <span id="total-q">20</span></span>
            <span id="timer-text" style="color:var(--fail); font-weight:bold;">10s</span>
        </div>
        
        <div class="question-box" id="question-text"></div>
        <div id="options-container"></div>
        <div id="spelling-container" class="input-group hidden">
            <input type="text" id="spelling-input" class="spelling-input" placeholder="輸入英文單字..." autocomplete="off">
            <button class="btn" onclick="submitSpelling()">送出</button>
        </div>
    </div>

    <div id="flashcard-screen" class="hidden">
        <button class="back-btn" onclick="goBackToHome()">⬅ 結束複習</button>
        
        <div class="flashcard-header">
            <span>剩餘卡片: <span id="fc-remaining">0</span></span>
        </div>

        <div class="flashcard-container" onclick="flipCard()">
            <div class="flashcard" id="flashcard">
                <div class="front">
                    <div class="fc-word" id="fc-front-text">Word</div>
                    <div class="fc-hint">點擊翻面 (Space)</div>
                </div>
                <div class="back">
                    <div class="fc-def" id="fc-back-zh">中文定義</div>
                    <div class="fc-ph" id="fc-back-ph">/yin-biao/</div>
                    <button class="btn-audio-circle" onclick="event.stopPropagation(); playCurrentWordAudio()">🔊</button>
                </div>
            </div>
        </div>

        <div class="flashcard-controls">
            <button class="btn btn-fail" onclick="handleFlashcardResult(false)">❌ 還不熟 (←)</button>
            <button class="btn btn-success" onclick="handleFlashcardResult(true)">✅ 我會了 (→)</button>
        </div>
    </div>

    <div id="stats-screen" class="hidden">
        <button class="back-btn" onclick="goBackToHome()">⬅ 回首頁</button>
        <h2>📊 學習分析</h2>
        
        <div class="chart-container">
            <h3>📈 成績趨勢 (最近10次)</h3>
            <canvas id="scoreChart"></canvas>
        </div>

        <div class="chart-container">
            <h3>🏆 範圍精通度</h3>
            <div style="height: 200px; display: flex; justify-content: center;">
                <canvas id="masteryChart"></canvas>
            </div>
            <p id="mastery-text" style="font-size: 0.9rem; margin-top: 10px; color: var(--sub-text);"></p>
        </div>
    </div>

    <div id="result-screen" class="hidden">
        <h1>測驗結果</h1>
        <h2 id="final-score-title"></h2>
        <p id="score-text"></p>
        <p id="max-combo-text" style="color: var(--combo); font-weight: bold;"></p>
        <div id="pass-fail-msg"></div>
        <button class="btn" onclick="goBackToHome()">回首頁</button>
        <div class="result-details" id="review-list"></div>
    </div>
</div>

<div class="fab-container">
    <div class="fab-menu hidden" id="fab-menu">
        <button class="fab-item fab-pill" onclick="exportData()" title="匯出進度">📤 匯出進度</button>
        <button class="fab-item fab-pill" onclick="importData()" title="匯入進度">📥 匯入進度</button>
        
        <button id="fab-dark-mode" class="fab-item" onclick="toggleDarkMode()" title="切換深色模式">🌙</button>
    </div>
    <button class="fab-btn" onclick="toggleFabMenu()" title="設定與功能">⚙️</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

<script src="script.js"></script>

</body>
</html>
